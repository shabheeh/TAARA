<%- include('../Layouts/Admin/header') -%>

    <!-- Vendors CSS -->
    <link rel="stylesheet" href="/Admin/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.css" />
    <link rel="stylesheet" href="/Admin/assets/vendor/libs/typeahead-js/typeahead.css" /> 
    <link rel="stylesheet" href="/Admin/assets/vendor/libs/apex-charts/apex-charts.css" />
    <link rel="stylesheet" href="/Admin/assets/vendor/libs/select2/select2.css">

    <!-- Page CSS -->
    <link rel="stylesheet" href="/Admin/assets/vendor/css/pages/app-ecommerce-dashboard.css" />

<!-- Helpers -->
<script src="/Admin/assets/vendor/js/helpers.js"></script>

<script src="/Admin/assets/js/config.js"></script>

</head>


<body>
  
<%- include('../Layouts/Admin/navbar') -%>

      

      <!-- Content wrapper -->
      <div class="content-wrapper">

        <!-- Content -->
        
          <div class="container-xxl flex-grow-1 container-p-y">
            
            
<div class="row gy-6">
  <!-- Congratulations card -->
  <div class="col-xl-8 col-lg-7 align-self-end mt-md-7 mt-lg-4 pt-md-2 pt-lg-0">
    <div class="card">
      <div class="row">
        <div class="col-12 col-md-6">
          <div class="card-body">
            <h4 class="card-title mb-9 text-truncate">Congratulations <span class="fw-bold">Shabeeh!</span>ðŸŽ‰</h4>
            <p class="mb-0">You can see the overall sales over the past years and othere details hereðŸ˜Ž</p>
          </div>
        </div>
        <div class="col-12 col-md-6 position-relative text-center">
          <img src="/Admin/assets/img/illustrations/illustration-john-2.png" class="card-img-position bottom-0 w-auto end-0 scaleX-n1-rtl" alt="View Profile">
        </div>
      </div>
    </div>
  </div>
  <!--/ Congratulations card -->
  <!-- Cards with icon profit and loss info -->
  <div class="col-xl-4 col-lg-5">
    <div class="row g-6">
      <div class="col-sm-6">
        <div class="card h-100">
          <div class="card-header d-flex align-items-center justify-content-between">
            <div class="avatar">
              <div class="avatar-initial bg-success rounded-circle shadow-xs">
                <i class="ri-money-dollar-circle-line ri-24px"></i>
              </div>
            </div>
            
          </div>
          <div class="card-body">
            <h6 class="mb-1">Revenue</h6>
            <div class="d-flex flex-wrap mb-1 align-items-center">
              <h4 class="mb-0 me-2">â‚¹<%= totalRevenue %></h4>
              <p class="text-success mb-0">+12%</p>
            </div>

          </div>
        </div>
      </div>
      <div class="col-sm-6">
        <div class="card h-100">
          <div class="card-header d-flex align-items-center justify-content-between">
            <div class="avatar">
              <div class="avatar-initial bg-info rounded-circle shadow-xs">
                <i class="ri-bank-card-line ri-24px"></i>
              </div>
            </div>
            
          </div>
          <div class="card-body">
            <h6 class="mb-1">Sales</h6>
            <div class="d-flex flex-wrap mb-1 align-items-center">
              <h4 class="mb-0 me-2"><%= totalOrders %></h4>
              <p class="text-success mb-0">+38%</p>
            </div>
 
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Weekly Sales Chart -->
  <div class="col-xl-6">
    <div class="card h-100">
      <div class="card-header">
        <div class="d-flex justify-content-between align-items-center">
          <h5 class="mb-0" id="salesTitle">Sales Overview</h5>
          <div class="d-flex align-items-center">
            <div class="me-2">
              <input type="month" id="month-select" class="form-control" style="display: none;">
              <input type="number" id="year-select" class="form-control" min="2000" max="2099" step="1" style="display: none;">
            </div>
            <div class="dropdown">
              <select id="filter-sales" class="form-select">
                <option value="daily">Daily</option>
                <option value="monthly">Monthly</option>
                <option value="yearly">Yearly</option>
              </select>
            </div>
          </div>
        </div>
        <!-- <p class="text-body mb-0" id="totalSales">Total Sales: Loading...</p> -->
      </div>
      <div class="card-body">
        <div id="salesChart"></div>
        <!-- <div class="d-flex align-items-center justify-content-around mt-4">
          <div class="d-flex align-items-center">
            <div class="avatar bg-light-primary rounded">
              <i class="ri-pie-chart-2-line text-primary"></i>
            </div>
            <div class="ms-3">
              <h6 class="mb-0" id="totalSalesCount">Loading...</h6>
              <small>Sales</small>
            </div>
          </div>
          <div class="d-flex align-items-center">
            <div class="avatar bg-light-success rounded">
              <i class="ri-money-dollar-circle-line text-success"></i>
            </div>
            <div class="ms-3">
              <h6 class="mb-0" id="totalProfit">Loading...</h6>
              <small>Total Profit</small>
            </div>
          </div>
        </div> -->
      </div>
    </div>
</div>
  <!-- Sales Overview Chart -->
  <div class="col-xl-6">
    <div class="card h-100">
      <div class="card-header">
        <div class="d-flex justify-content-between">
          <h5 class="mb-0">Best Selling Brands</h5>
        </div>
      </div>
      <div class="card-body pt-lg-5">
        <div class="row align-items-center">
          <div class="col-md-6" style="position: relative;">
            <div id="salesOverviewChart" style="min-height: 247.8px;"></div>
          </div>
          <div class="col-md-6 mt-3 mt-md-0">
            <div class="d-flex align-items-center">
              <div class="avatar">
                <div class="avatar-initial bg-label-primary rounded">
                  <i class="ri-wallet-line ri-24px"></i>
                </div>
              </div>
              <div class="ms-3 d-flex flex-column">
                <p class="mb-0">Number of Products Sold</p>
                <h5 class="mb-0"><%= totalProductsSold %></h5>
              </div>
            </div>
            <hr class="my-6">
            <div class="row g-4">
              <% chartData.forEach((item, index) => { %>
                <div class="col-6">
                  <div class="d-flex align-items-center mb-1">
                    <div class="badge badge-dot me-2" 
                         style="background-color: <%= index === 0 ? '#8c57ff' : 
                                                  index === 1 ? '#9055fdb3' : 
                                                  index === 2 ? '#9055fd80' : 
                                                  index === 3 ? '#f0f2f8' : '#cccccc' %>;">
                    </div>
                    <p class="mb-0"><%= item.name %></p>
                  </div>
                  <p class="fw-medium mb-0"><%= item.count %></p>
                </div>
              <% }); %>
            </div>
            
          </div>
        </div>
      </div>
    </div>
  </div>

  
  <!--/ Total Profit Chart & Last month balance -->
  <!-- three chart -->
  

  <!--/ three chart -->
  <!-- Top Products -->
   <% if (topProducts && topProducts.length > 0) { %>
    <div class="col-lg-6 col-xxl-4 mb-6 order-2 order-xxl-2">
      <div class="card h-100">
        <div class="card-header d-flex align-items-center justify-content-between">
          <div class="card-title mb-0">
            <h5 class="m-0 me-2">Top Selling Products</h5>
  
          </div>
           
        </div>
        <div class="card-body">
          <ul class="p-0 m-0">
            <% topProducts.forEach((item, index) => { %>
              <li class="d-flex mb-4 pb-1 align-items-center">
  
                <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                  <div class="me-2">
                    <h6 class="mb-0 fw-normal"><%= item.name %></h6>
                    <small class="text-success fw-normal d-block">
                      <%= item.gender %>
                    </small>
                  </div>
                  <div class="user-progress">
                    <h6 class="mb-0"><%= item.totalQuantity %></h6>
                  </div>
                </div>
              </li>
            <% }) %>
            
            
          </ul>
        </div>
      </div>
    </div>
   <% } %>
  
  <!--/ Top Products -->

<!-- Top Categories -->
<% if (topCategories && topCategories.length > 0) { %>
  <div class="col-lg-6 col-xxl-4 mb-6 order-2 order-xxl-2">
    <div class="card h-100">
      <div class="card-header d-flex align-items-center justify-content-between">
        <div class="card-title mb-0">
          <h5 class="m-0 me-2">Top Selling Categoreies</h5>

        </div>
         
      </div>
      <div class="card-body">
        <ul class="p-0 m-0">
          <% topCategories.forEach((item, index) => { %>
            <li class="d-flex mb-4 pb-1 align-items-center">

              <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                <div class="me-2">
                  <h6 class="mb-0 fw-normal"><%= item.name %></h6>
                  <small class="text-success fw-normal d-block">
                    <%= item.gender %>
                  </small>
                </div>
                <div class="user-progress">
                  <h6 class="mb-0"><%= item.totalQuantity %></h6>
                </div>
              </div>
            </li>
          <% }) %>
          
          
        </ul>
      </div>
    </div>
  </div>
 <% } %>

<!--/ Top Categoreies -->

<!-- Top Categories -->
<% if (topBrands && topBrands.length > 0) { %>
  <div class="col-lg-6 col-xxl-4 mb-6 order-2 order-xxl-2">
    <div class="card h-100">
      <div class="card-header d-flex align-items-center justify-content-between">
        <div class="card-title mb-0">
          <h5 class="m-0 me-2">Top Selling Brands</h5>

        </div>
         
      </div>
      <div class="card-body">
        <ul class="p-0 m-0">
          <% topBrands.forEach((item, index) => { %>
            <li class="d-flex mb-4 pb-1 align-items-center">

              <div class="d-flex w-100 flex-wrap align-items-center justify-content-between gap-2">
                <div class="me-2">
                  <h6 class="mb-0 fw-normal"><%= item.name %></h6>
                  <small class="text-success fw-normal d-block">
                    <%= item.gender %>
                  </small>
                </div>
                <div class="user-progress">
                  <h6 class="mb-0"><%= item.totalQuantity %></h6>
                </div>
              </div>
            </li>
          <% }) %>
          
          
        </ul>
      </div>
    </div>
  </div>
 <% } %>

<!--/ Top Categoreies -->


  <!-- New visitors cards -->
  
  <!--/ Website Statistics -->
  <!-- Card DataTable -->
  
  <!--/ Card DataTable -->
  <!-- Meeting Schedule -->
  
  <!--/ Meeting Schedule -->
</div>

          </div>
          <!-- / Content -->

          
          

<!-- Footer -->
<footer class="content-footer footer bg-footer-theme">
  <div class="container-xxl">
    <div class="footer-container d-flex align-items-center justify-content-between py-4 flex-md-row flex-column">
      
    </div>
  </div>
</footer>
<!-- / Footer -->

          
          <div class="content-backdrop fade"></div>
        </div>
        <!-- Content wrapper -->
      </div>
      <!-- / Layout page -->
    </div>

    
    
    <!-- Overlay -->
    <div class="layout-overlay layout-menu-toggle"></div>
    
    
    <!-- Drag Target Area To SlideIn Menu On Small Screens -->
    <div class="drag-target"></div>
    
  </div>
  <!-- / Layout wrapper -->

  
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const chartData = <%- JSON.stringify(chartData) %>;
      
      const options = {
        series: chartData.map(item => item.value),
        chart: {
          width: 300,
          type: 'donut',
        },
        labels: chartData.map(item => item.name),
        dataLabels: {
          enabled: false
        },
        colors: ['#8c57ff', '#9055fdb3', '#9055fd80', '#f0f2f8'],
        plotOptions: {
          pie: {
            donut: {
              size: '70%',
              labels: {
                show: true,
                name: {
                  show: true,
                  fontSize: '15px',
                  fontFamily: 'Inter, sans-serif',
                  color: '#6d6777',
                  offsetY: -10
                },
                value: {
                  show: true,
                  fontSize: '24px',
                  fontFamily: 'Inter, sans-serif',
                  color: '#433c50',
                  offsetY: 10,
                  formatter: function (val) {
                    return val + '%';
                  }
                },
                total: {
                  show: true,
                  label: 'Best Sellers',
                  color: '#6d6777',
                  formatter: function () {
                    return '' ;
                  }
                }
              }
            }
          }
        },
        legend: {
          show: false
        }
      };
    
      const chart = new ApexCharts(document.querySelector("#salesOverviewChart"), options);
      chart.render();
    });
    </script>
  
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    document.addEventListener('DOMContentLoaded', function () {
    const filterSales = document.getElementById('filter-sales');
    const monthSelect = document.getElementById('month-select');
    const yearSelect = document.getElementById('year-select');
    const salesTitle = document.getElementById('salesTitle');
    let chart;

    
    function updateInputVisibility() {
        const filter = filterSales.value;
        monthSelect.style.display = filter === 'daily' ? 'block' : 'none';
        yearSelect.style.display = filter === 'monthly' ? 'block' : 'none';
        
        if (filter === 'daily') {
            salesTitle.textContent = 'Daily Sales';
        } else if (filter === 'monthly') {
            salesTitle.textContent = 'Monthly Sales';
        } else {
            salesTitle.textContent = 'Yearly Sales';
        }
    }

    function fetchAndRenderSalesData() {
        const filter = filterSales.value;
        let date;
        
        if (filter === 'daily') {
            date = monthSelect.value;
        } else if (filter === 'monthly') {
            date = yearSelect.value;
        } else {
            // For yearly, we don't need a specific date
            date = '';
        }

        fetch(`/admin/dashboard/salesgraph?filterSales=${filter}&date=${date}`)
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    renderSalesChart(result.data, filter);
                    // updateTotals(result.totalSales);
                } else {
                    console.error('Error in API response:', result.message);
                }
            })
            .catch(error => console.error('Error fetching sales data:', error));
    }

    function renderSalesChart(data, filter) {
        const options = {
            series: [{
                name: 'Sales',
                data: data.map(item => item.value)
            }],
            chart: {
                type: 'bar',
                height: 300,
                toolbar: {
                    show: false
                }
            },
            plotOptions: {
                bar: {
                    borderRadius: 4,
                    columnWidth: '60%',
                }
            },
            dataLabels: {
                enabled: false
            },
            xaxis: {
                categories: data.map(item => item.name),
                axisBorder: {
                    show: false
                },
                axisTicks: {
                    show: false
                }
            },
            yaxis: {
                title: {
                    text: 'Sales'
                }
            },
            colors: ['#9055fdb3'],
            states: {
                hover: {
                    filter: {
                        type: 'darken',
                        value: 0.9
                    }
                }
            },
            tooltip: {
                y: {
                    formatter: function (val) {
                        return `$${val.toFixed(2)}`;
                    }
                }
            }
        };

        if (chart) {
            chart.updateOptions(options);
        } else {
            chart = new ApexCharts(document.querySelector("#salesChart"), options);
            chart.render();
        }

        // Highlight the highest sales
        const maxIndex = data.reduce((iMax, x, i, arr) => x.value > arr[iMax].value ? i : iMax, 0);
        chart.toggleDataPointSelection(0, maxIndex);
    }

    // function updateTotals(totalSales) {
    //     document.getElementById('totalSales').textContent = `Total Sales: $${totalSales.toFixed(2)}`;
    //     document.getElementById('totalSalesCount').textContent = `${(totalSales / 1000).toFixed(1)}k`;
    //     document.getElementById('totalProfit').textContent = `$${(totalSales * 0.2).toFixed(2)}k`;
    // }

    // Update chart when filter or date changes
    filterSales.addEventListener('change', function() {
        updateInputVisibility();
        fetchAndRenderSalesData();
    });
    monthSelect.addEventListener('change', fetchAndRenderSalesData);
    yearSelect.addEventListener('change', fetchAndRenderSalesData);

    // Set initial values
    const currentDate = new Date();
    monthSelect.value = `${currentDate.getFullYear()}-${(currentDate.getMonth() + 1).toString().padStart(2, '0')}`;
    yearSelect.value = currentDate.getFullYear();

    // Initial setup
    updateInputVisibility();
    fetchAndRenderSalesData();
});
</script>

    <!-- Core JS -->
  <!-- build:js assets/vendor/js/core.js -->
  <script src="/Admin/assets/vendor/libs/jquery/jquery.js"></script>
  <script src="/Admin/assets/vendor/libs/popper/popper.js"></script>
  <script src="/Admin/assets/vendor/js/bootstrap.js"></script>
  <script src="/Admin/assets/vendor/libs/node-waves/node-waves.js"></script>
  <script src="/Admin/assets/vendor/libs/perfect-scrollbar/perfect-scrollbar.js"></script>
  <script src="/Admin/assets/vendor/libs/hammer/hammer.js"></script>
  <script src="/Admin/assets/vendor/libs/i18n/i18n.js"></script>
  <script src="/Admin/assets/vendor/libs/typeahead-js/typeahead.js"></script>
  <script src="/Admin/assets/vendor/js/menu.js"></script>
  
  <!-- endbuild -->

  <!-- Vendors JS -->
  <script src="/Admin/assets/vendor/libs/moment/moment.js"></script>
<script src="/Admin/assets/vendor/libs/datatables-bs5/datatables-bootstrap5.js"></script>
<script src="/Admin/assets/vendor/libs/apex-charts/apexcharts.js"></script>
<script src="/Admin/assets/vendor/libs/rateyo/rateyo.js"></script>
<script src="/Admin/assets/vendor/libs/cleavejs/cleave.js"></script>
<script src="/Admin/assets/vendor/libs/cleavejs/cleave-phone.js"></script>
<script src="/Admin/assets/vendor/libs/select2/select2.js"></script>



<script src="/Admin/assets/js/app-ecommerce-dashboard.js"></script>

  <!-- Main JS -->
  <script src="/Admin/assets/js/main.js"></script>
</body>


<!-- Mirrored from demos.themeselection.com/materio-bootstrap-html-admin-template/html/vertical-menu-template/app-ecommerce-dashboard.html by HTTrack Website Copier/3.x [XR&CO'2014], Tue, 25 Jun 2024 05:47:59 GMT -->
</html>

<!-- beautify ignore:end -->

